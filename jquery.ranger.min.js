(function(b){var a=(function(){var d={countOf:function(h,g){return h.split(g).length-1},countOfRN:function(j,l,k){var h=0,g=0;if(typeof l!="undefined"&&typeof k!="undefined"){for(g=0;g<l;g++){if(j.charAt(g)+j.charAt(g+1)=="\r\n"){l=l+1}}for(g=0;g<k;g++){if(j.charAt(g)+j.charAt(g+1)=="\r\n"){k=k+1}}for(g=l;g<k-1;g++){if(j.charAt(g)+j.charAt(g+1)=="\r\n"){h=h+1}}}else{for(g=0;g<this.length-1;g++){if(j.charAt(g)+j.charAt(g+1)=="\r\n"){h=h+1}}}return h}};var c=function c(g){if(typeof g!="undefined"){this.input=g}else{throw"Initialization error: Ranger must be initialized with some input element."}"init" in this&&this.init()};c.prototype={constructor:c};var f=document.createElement("textarea");if("createTextRange" in f){var e=function(g){if(typeof g!="undefined"){this.input=g}else{throw"Initialization error: RangeSaver must init with some input element."}this.isFocused=false;this.savedRange=null;this.init()};e.prototype={constructor:e,init:function(){this.behavior()},behavior:function(){var h=this,g=function(){h.saveRange()};this.input.attachEvent("onclick",g,false);this.input.attachEvent("onkeyup",g,false);this.input.attachEvent("onkeydown",g,false);this.input.attachEvent("onselect",g,false);this.input.attachEvent("onfocus",function(){h.isFocused=true;h.saveRange()},false);this.input.attachEvent("onblur",function(){h.isFocused=false},false)},saveRange:function(){if(this.isFocused){this.savedRange=document.selection.createRange()}},getRange:function(){return this.savedRange}};c.prototype.init=function(){var h=document.activeElement,g=this.input.createTextRange();g.expand("textedit");g.collapse(true);this.rangeSaver=new e(this.input);this.input.fireEvent("onfocus");h.fireEvent("onfocus")};c.prototype.getCursorPosition=function(l){var l=l||false,h=null,g=this.input.value,i=this.rangeSaver.getRange(),k=i.text,j="~#@";i.text=j;var m=this.input.value.indexOf(j);if(l){h=-g.length+m-1+d.countOf(g.substring(m,g.length-1),"\n")}else{h=m-d.countOf(this.input.value.substring(0,m),"\n")}i.moveStart("character",-j.length);i.select();i.text=k;i.moveStart("character",-k.length);i.select();return h};c.prototype.__getCursorPosition=function(l){var l=l||false,h=null,g=this.input.value,i=this.rangeSaver.getRange(),k=i.text,j="~#@";i.text=j;var m=this.input.value.indexOf(j);if(l){h=-g.length+m-1}else{h=m}i.moveStart("character",-j.length);i.select();i.text=k;i.moveStart("character",-k.length+d.countOf(k,"\n"));i.select();return h};c.prototype.setCursorPosition=function(g){var h=this.input.createTextRange();h.expand("textedit");if(g<0){h.moveEnd("character",g+1);h.collapse(false)}else{h.moveStart("character",g);h.collapse(true)}h.select();this.rangeSaver.saveRange()};c.prototype.insertAtCursor=function(j){var h=this.getCursorPosition(),i=this.__getCursorPosition(),g=this.input.value;this.input.value=g.substr(0,i)+j+g.substr(i,g.length);this.setCursorPosition(h+j.length)};c.prototype.select=function(h,j){var g=this.input.createTextRange(),i=this.input.value.length-d.countOf(this.input.value,"\n");g.expand("textedit");g.collapse(true);if(j<0){var j=i+j+1}if(h<0){var h=i+h+1}g.moveEnd("character",Math.max(h,j));g.moveStart("character",Math.min(h,j));g.select();this.rangeSaver.saveRange()};c.prototype.getSelectedText=function(){var g=document.selection,h=g.createRange();if(g.type.toLowerCase()=="text"){return h.text}return""};c.prototype.replaceSelectedText=function(k){var h=this.input.value,j=this.getSelectedText().length,i=this.__getCursorPosition(),g=this.getCursorPosition();this.input.value=h.substr(0,i)+k+h.substr(i+j,h.length);this.setCursorPosition(g+k.length)}}else{if("getSelection" in window){c.prototype.getCursorPosition=function(g){var g=g||false;if(this.input.selectionStart||this.input.selectionStart=="0"){if(g){return(-this.input.value.length+d.countOf(this.input.value,"\r\n")-d.countOf(this.input.value.substring(0,this.input.selectionStart+1),"\r\n")+this.input.selectionStart-1)}else{return this.input.selectionStart-d.countOf(this.input.value.substring(0,this.input.selectionStart+1),"\r\n")}}}}if("setSelectionRange" in f){c.prototype.setCursorPosition=function(g){var g=g||0;if(g<0){g=this.input.value.length+g+1}else{g=g+d.countOfRN(this.input.value,0,g)}this.input.setSelectionRange(g,g)};c.prototype.select=function(k,j){var i=this.input.value.replace(/\r\n/g,"\n").length,k=(k<0?i+k+1:k),j=(j<0?i+j+1:j);var h=Math.min(k,j),g=Math.max(k,j);this.input.setSelectionRange(h+d.countOfRN(this.input.value,0,h),g+d.countOfRN(this.input.value,0,g))}}c.prototype.insertAtCursor=function(i){var h=this.getCursorPosition(),g=this.input.value;this.input.value=g.substr(0,h+d.countOfRN(g,0,h))+i+g.substr(h+d.countOfRN(g,0,h),g.length);this.setCursorPosition(h+i.length)};c.prototype.replaceSelectedText=function(j){var h=this.input.value,g=this.getCursorPosition(),i=this.getSelectedText().length;this.input.value=h.substr(0,g+d.countOfRN(h,0,g))+j+h.substr(g+i+d.countOfRN(h,0,g+i),h.length);this.setCursorPosition(g+j.length)};if("getSelection" in window){c.prototype.getSelectedText=function(){return this.input.value.substring(this.input.selectionStart,this.input.selectionEnd)}}}c.prototype.wrapCursor=function(h,i){var g=this.getCursorPosition();this.insertAtCursor(h+i);this.setCursorPosition(g+h.length)};c.prototype.deselect=function(){this.setCursorPosition(this.getCursorPosition())};c.prototype.wrapSelectedText=function(g,h){this.replaceSelectedText(g+this.getSelectedText()+h)};return c})();b.fn.ranger=function(f){var c=[];this.each(function(){var h=b(this),g=this.tagName.toLowerCase();if(g=="input"||g=="textarea"){if(!h.data("instance.Ranger")){h.data("instance.Ranger",new a(this))}c.push(h.data("instance.Ranger"))}else{c.push(null)}});if(typeof f=="function"){for(var e=0;e<c.length;e++){var d=c[e];if(d!=null){f.apply(d,[])}}}return c};b.fn.getCursorPosition=function(g){var d=this.ranger();if(d.length){if(d.length==1){return d[0].getCursorPosition(g||false)}else{var c=[];for(var f=0;f<d.length;f++){var e=d[f];if(e!=null){c.push(e.getCursorPosition(g||false))}}return c}}return this};b.fn.setCursorPosition=function(c){this.ranger(function(){this.input.focus();this.setCursorPosition(c||0)});return this};b.fn.insertAtCursor=function(c){this.ranger(function(){this.insertAtCursor(c||"")});return this};b.fn.wrapCursor=function(c,d){this.ranger(function(){this.wrapCursor(c||"",d||"")});return this};b.fn.select=function(d,c){var d=(typeof d!="undefined"?d:0),c=(typeof c!="undefined"?c:-1);this.ranger(function(){this.input.focus();this.select(d,c)});return this};b.fn.deselect=function(){this.ranger(function(){this.deselect()});return this};b.fn.getSelectedText=function(){var c=this.ranger();if(c.length){if(c.length==1){return c[0].getSelectedText()}else{var f=[];for(var e=0;e<c.length;e++){var d=c[e];if(d!=null){f.push(d.getSelectedText())}}return f}}return this};b.fn.replaceSelectedText=function(c){this.ranger(function(){this.replaceSelectedText(c||"")});return this};b.fn.wrapSelectedText=function(c,d){this.ranger(function(){this.wrapSelectedText(c||"",d||"")});return this}})(jQuery);